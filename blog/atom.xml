<?xml version="1.0" encoding="utf-8"?><?xml-stylesheet type="text/xsl" href="atom.xsl"?>
<feed xmlns="http://www.w3.org/2005/Atom">
    <id>https://orbits.do/blog</id>
    <title>Orbits documentation Blog</title>
    <updated>2025-06-25T00:00:00.000Z</updated>
    <generator>https://github.com/jpmonette/feed</generator>
    <link rel="alternate" href="https://orbits.do/blog"/>
    <subtitle>Orbits documentation Blog</subtitle>
    <icon>https://orbits.do/img/favicon.ico</icon>
    <entry>
        <title type="html"><![CDATA[Solving cross-account resources for AWS CDK]]></title>
        <id>https://orbits.do/blog/cross-account-cdk</id>
        <link href="https://orbits.do/blog/cross-account-cdk"/>
        <updated>2025-06-25T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[If you've ever tried to build a multi-account AWS architecture using CDK or CloudFormation, you've probably hit the same frustrating wall: cross-account resource references don't work without manual coordination and hardcoded values. What should be a simple task—like reading a parameter from Account A in a Lambda function deployed to Account B—becomes a tedious manual process. This behaviour is already documented and while AWS also documents workarounds, there’s no indication that this is going to change anytime soon. However, these approaches don't scale when you have multiple services and resources spanning different accounts across your organization.]]></summary>
        <content type="html"><![CDATA[<p>If you've ever tried to build a multi-account AWS architecture using CDK or CloudFormation, you've probably hit the same frustrating wall: cross-account resource references don't work without manual coordination and hardcoded values. What should be a simple task—like reading a parameter from Account A in a Lambda function deployed to Account B—becomes a tedious manual process. This behaviour is already <a href="https://www.luminis.eu/blog/cross-account-aws-resource-access-with-aws-cdk/" target="_blank" rel="noopener noreferrer">documented</a> and while AWS also documents <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/walkthrough-crossstackref.html" target="_blank" rel="noopener noreferrer">workarounds</a>, there’s no indication that this is going to change anytime soon. However, these approaches don't scale when you have multiple services and resources spanning different accounts across your organization.</p>
<p>This post walks through a practical example that demonstrates both the problem and a solution using orbits, a tool designed to seamless orchestrate all of your IaC with code.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="the-cross-account-problem">The Cross-Account Problem<a href="https://orbits.do/blog/cross-account-cdk#the-cross-account-problem" class="hash-link" aria-label="Direct link to The Cross-Account Problem" title="Direct link to The Cross-Account Problem">​</a></h2>
<p>AWS CDK and CloudFormation have a limitation: stacks cannot directly reference resources from other AWS accounts. This creates friction for common architectural patterns like:</p>
<ul>
<li>Sharing Docker images between development and production accounts</li>
<li>Accessing centralized secrets from distributed applications</li>
<li>Setting up VPC peering connections</li>
<li>Managing cross-account S3 bucket permissions</li>
<li>Distributing Lambda layers across organizational boundaries</li>
</ul>
<p>Here's what this limitation looks like in practice:</p>
<div class="language-typescript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-typescript codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> app </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">cdk</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">App</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> paramA </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">ParamStack</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">app</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'stack-A'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    env</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> account</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"account-A"</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> lambdaB </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">LambdaStack</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">app</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'stack-B'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    parameterArn</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> paramA</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">parameter</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">arn</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// ❌ This fails at synthesis time</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    env</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> account</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"account-B"</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
<p>The traditional workaround involves manual steps: extracting ARNs, hardcoding values, coordinating resource policies, and deploying in specific sequences. This breaks the declarative nature of infrastructure-as-code and makes architectures brittle.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="a-real-world-example">A Real-World Example<a href="https://orbits.do/blog/cross-account-cdk#a-real-world-example" class="hash-link" aria-label="Direct link to A Real-World Example" title="Direct link to A Real-World Example">​</a></h2>
<p>Here's an "hello-world" scenario to illustrate the problem: deploying an AWS Systems Manager parameter in Account A and reading it from a Lambda function in Account B. While the "cross-account sharing" feature for AWS SSM parameter could be used, this simple use case illustrates the broader challenge perfectly.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="the-traditional-cdk-approach-doesnt-scale">The Traditional CDK Approach (Doesn't scale)<a href="https://orbits.do/blog/cross-account-cdk#the-traditional-cdk-approach-doesnt-scale" class="hash-link" aria-label="Direct link to The Traditional CDK Approach (Doesn't scale)" title="Direct link to The Traditional CDK Approach (Doesn't scale)">​</a></h3>
<p>With standard CDK, you'd need to:</p>
<ol>
<li>Deploy the parameter stack in Account A</li>
<li>Manually extract the parameter ARN</li>
<li>Hardcode the ARN into your Lambda stack for Account B</li>
<li>Manually configure cross-account IAM policies</li>
<li>Deploy the Lambda stack in Account B</li>
<li>Hope nothing changes, because updates require repeating this process</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="the-orchestration-solution-with-orbits">The Orchestration Solution with orbits<a href="https://orbits.do/blog/cross-account-cdk#the-orchestration-solution-with-orbits" class="hash-link" aria-label="Direct link to The Orchestration Solution with orbits" title="Direct link to The Orchestration Solution with orbits">​</a></h3>
<p>With orbits, the same architecture becomes straightforward:</p>
<div class="language-typescript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-typescript codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> paramOutput </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">await</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">do</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"updateParam"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">ParamResource</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">await</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">do</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"updateLambda"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">LambdaResource</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">setArgument</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    stackProps</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        parameterArn</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> paramOutput</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">parameterArn</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// ✅ Direct cross-account reference</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        env</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> account</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">argument</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">accountB</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">id </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
<p>The key difference? Orbits handles the cross-account coordination automatically, allowing you to reference resources naturally regardless of which account they live in.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="hands-on-building-the-example">Hands-On: Building the Example<a href="https://orbits.do/blog/cross-account-cdk#hands-on-building-the-example" class="hash-link" aria-label="Direct link to Hands-On: Building the Example" title="Direct link to Hands-On: Building the Example">​</a></h2>
<p>The following section walks through building this cross-account parameter example step by step.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="prerequisites">Prerequisites<a href="https://orbits.do/blog/cross-account-cdk#prerequisites" class="hash-link" aria-label="Direct link to Prerequisites" title="Direct link to Prerequisites">​</a></h3>
<p>You'll need:</p>
<ul>
<li>Access to two AWS accounts with CloudFormation deployment permissions</li>
<li>Node.js and npm installed</li>
<li>MongoDB instance for orbits state management</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="project-setup">Project Setup<a href="https://orbits.do/blog/cross-account-cdk#project-setup" class="hash-link" aria-label="Direct link to Project Setup" title="Direct link to Project Setup">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># Clone the repository</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">git clone &lt;repository-url&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cd cross-account-example</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Install dependencies</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">npm install</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Configure environment</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cp .base.env .env</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Edit .env with your account details</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">vi .env</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="project-structure">Project structure<a href="https://orbits.do/blog/cross-account-cdk#project-structure" class="hash-link" aria-label="Direct link to Project structure" title="Direct link to Project structure">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">├── src/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   ├── orbits/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   │   └── orbi.ts # Main orchestration script</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   │   ├── lambda-resource.ts # lambda resource definition</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   │   ├── param-resource.ts # Param resource definition</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   │   ├── hello-resource.ts # Hello resource definition : the resource that make the junction between param and lambda</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   ├── cdk/              # CDK stack definitions</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   │   ├── lambda.ts # lambda CDK stack</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   │   ├── param.ts # Param CDK stack</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── .base.env                # Environment template</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── .env                     # Your environment variables (git-ignored)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── package.json</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└── README.md</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="the-resource-definitions">The Resource Definitions<a href="https://orbits.do/blog/cross-account-cdk#the-resource-definitions" class="hash-link" aria-label="Direct link to The Resource Definitions" title="Direct link to The Resource Definitions">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="lambda-and-param-cdk-stack">Lambda and Param CDK Stack<a href="https://orbits.do/blog/cross-account-cdk#lambda-and-param-cdk-stack" class="hash-link" aria-label="Direct link to Lambda and Param CDK Stack" title="Direct link to Lambda and Param CDK Stack">​</a></h4>
<p>We focus on two stack <code>LambdaStack</code> and <code>ParameterStoreStack</code>
[link to the stack]</p>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="lambda-stack">Lambda stack<a href="https://orbits.do/blog/cross-account-cdk#lambda-stack" class="hash-link" aria-label="Direct link to Lambda stack" title="Direct link to Lambda stack">​</a></h5>
<p>A lambda that will display the value of the parameter passed in parameter if it can access it.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="parameter-stack">Parameter stack<a href="https://orbits.do/blog/cross-account-cdk#parameter-stack" class="hash-link" aria-label="Direct link to Parameter stack" title="Direct link to Parameter stack">​</a></h4>
<p>A parameter store that stores an "hello-world" value.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="encapsulate-the-stacks-in-a-resource-definition">Encapsulate the stacks in a resource definition.<a href="https://orbits.do/blog/cross-account-cdk#encapsulate-the-stacks-in-a-resource-definition" class="hash-link" aria-label="Direct link to Encapsulate the stacks in a resource definition." title="Direct link to Encapsulate the stacks in a resource definition.">​</a></h4>
<p>Here's what a CDK resource definitions look like:</p>
<p><strong>Lambda Resource (lambda-resource.ts):</strong></p>
<div class="language-typescript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_OeMC">src/orbits/lambda-resource.ts</div><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-typescript codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">LambdaResource</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">extends</span><span class="token plain"> </span><span class="token class-name">CdkStackResource</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    StackConstructor </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> LambdaStack</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">declare</span><span class="token plain"> IOutput </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string-property property" style="color:#36acaa">"roleArn"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">string</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<p>Let's go line by line.</p>
<ul>
<li><code>StackConstructor = LambdaStack</code> : this tells the orchestrator that <code>LambdaResource</code> will use the <code>LambdaStack</code> class constructor to define and manage its infrastructure.</li>
<li></li>
</ul>
<div class="language-typescript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-typescript codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">declare</span><span class="token plain"> IOutput </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string-property property" style="color:#36acaa">"roleArn"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">string</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><br></span></code></pre></div></div>
<p>The CloudFormation stack for the Lambda function exports a single output: "roleArn", which is the ARN of the Lambda's execution role.
The IOutput declaration is used for type safety—it informs the developer that this resource will expose an output matching that structure.</p>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_BuS1"><p>If not already done, the CDK environment will be automatically bootstrapped by the CDKResource—no other step is required, the fulllifecycle of your resource is managed.</p></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="write-a-proxy-resource-to-orchestrate-both-lambda-and-param-deployment">Write a proxy resource to orchestrate both lambda and param deployment<a href="https://orbits.do/blog/cross-account-cdk#write-a-proxy-resource-to-orchestrate-both-lambda-and-param-deployment" class="hash-link" aria-label="Direct link to Write a proxy resource to orchestrate both lambda and param deployment" title="Direct link to Write a proxy resource to orchestrate both lambda and param deployment">​</a></h4>
<p>We could choose different orchestrations stategies.
Here we choose to have a proxy resources that deploy both the <code>Param</code> and the <code>Lambda</code> stack and that synchronize the use of both in coordination.</p>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="install-step">Install step<a href="https://orbits.do/blog/cross-account-cdk#install-step" class="hash-link" aria-label="Direct link to Install step" title="Direct link to Install step">​</a></h5>
<p>During the first step, we launch a first deployment of the <code>Lambda</code> stack.
At this step, the <code>ParamStore</code> stack does not exist, so no optional properties are passed.</p>
<div class="language-typescript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-typescript codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">async</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">defineInstall</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">await</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">do</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"firstDeployLambda"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">constructLambdaResource</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">constructLambdaResource</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">LambdaResource</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">setArgument</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            stackName</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"lambda"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            awsProfileName</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">argument</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">accountB</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">profile</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            stackProps</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                env</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    region</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">argument</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">region</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    account</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">argument</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">accountB</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">id</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="update-step">Update step<a href="https://orbits.do/blog/cross-account-cdk#update-step" class="hash-link" aria-label="Direct link to Update step" title="Direct link to Update step">​</a></h5>
<p>When updating the resource, we deploy both the <code>Param</code> and <code>Lambda</code> stack.</p>
<div class="language-typescript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-typescript codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">async</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">defineUpdate</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> lambdaResource </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">constructLambdaResource</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> lambdaOutput </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">await</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">do</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"getLambdaOutput"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> lambdaResource</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getResourceOutput</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> paramOutput </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">await</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">do</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"updateParam"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">constructParamResource</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">lambdaOutput</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">await</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">do</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"updateLambda"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">constructLambdaResource</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">paramOutput</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<p><code>ParamResource</code> consumes the output of <code>LambdaResource</code> and vice versa.
As a consequence, we need to refine the constructs methods.</p>
<div class="language-typescript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-typescript codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">constructLambdaResource</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">paramOutput</span><span class="token operator" style="color:#393A34">?</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> ParamResource</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">'IOutput'</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">LambdaResource</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">setArgument</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            stackName</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"lambda"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            awsProfileName</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">argument</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">accountB</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">profile</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            stackProps</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                accountARoleArn</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> paramOutput</span><span class="token operator" style="color:#393A34">?.</span><span class="token plain">roleArn</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                parameterArn</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> paramOutput</span><span class="token operator" style="color:#393A34">?.</span><span class="token plain">paramArn</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                env</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    region</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">argument</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">region</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    account</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">argument</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">accountB</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">id</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">constructParamResource</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">lambdaOutput</span><span class="token operator" style="color:#393A34">?</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> LambdaResource</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">'IOutput'</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">ParamResource</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">setArgument</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            stackName</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"param"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            awsProfileName</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">argument</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">accountA</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">profile</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            stackProps</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                accountBId</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">argument</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">accountB</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">id</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                accountBRoleArn</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> lambdaOutput</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">roleArn</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                env</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    region</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">argument</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">region</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    account</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">argument</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">accountA</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">id</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="uninstall-step">Uninstall step<a href="https://orbits.do/blog/cross-account-cdk#uninstall-step" class="hash-link" aria-label="Direct link to Uninstall step" title="Direct link to Uninstall step">​</a></h4>
<p>To uninstall, we uninstall both the <code>Lambda</code> and <code>ParamStore</code> stacks.</p>
<div class="language-typescript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-typescript codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">async</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">defineUninstall</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">await</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">do</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"uninstallLambda"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">constructLambdaResource</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">setCommand</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"Uninstall"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">await</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">do</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"uninstallParam"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">constructParamResource</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">setCommand</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"Uninstall"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="deployment">Deployment<a href="https://orbits.do/blog/cross-account-cdk#deployment" class="hash-link" aria-label="Direct link to Deployment" title="Direct link to Deployment">​</a></h3>
<p>The entire cross-account deployment happens with a single command:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">export $(cat .env | xargs)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">export ORBITS_DB__MONGO__URL=your-mongo-url</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">npx tsx src/orbits/orbi.ts</span><br></span></code></pre></div></div>
<p>This orchestrates:</p>
<ol>
<li>Parameter deployment in Account A</li>
<li>Cross-account IAM policy setup</li>
<li>Lambda function deployment in Account B</li>
<li>All necessary permissions and configurations</li>
</ol>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="verification">Verification<a href="https://orbits.do/blog/cross-account-cdk#verification" class="hash-link" aria-label="Direct link to Verification" title="Direct link to Verification">​</a></h4>
<p>After deployment, you can test the Lambda function in Account B. It will successfully retrieve the parameter from Account A, demonstrating seamless cross-account access.</p>
<p>The Lambda logs will show:</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Param: hello-world</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="cleanup">Cleanup<a href="https://orbits.do/blog/cross-account-cdk#cleanup" class="hash-link" aria-label="Direct link to Cleanup" title="Direct link to Cleanup">​</a></h3>
<p>To remove all deployed resources from both accounts:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">export HELLO_COMMAND=uninstall</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">npx tsx src/orbits/orbi.ts</span><br></span></code></pre></div></div>
<p>⚠️ Warning: This will permanently delete all resources created by this example. Make sure you want to remove everything before running this command.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="why-this-matters">Why This Matters<a href="https://orbits.do/blog/cross-account-cdk#why-this-matters" class="hash-link" aria-label="Direct link to Why This Matters" title="Direct link to Why This Matters">​</a></h2>
<p>This example might seem simple, but it represents a fundamental gain in how we think about multi-account architectures. Instead of treating cross-account access as an exception requiring special handling, orbits makes it a first-class citizen of your infrastructure-as-code workflow. It allows to completly automate cross-account resources definition.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="key-benefits">Key Benefits<a href="https://orbits.do/blog/cross-account-cdk#key-benefits" class="hash-link" aria-label="Direct link to Key Benefits" title="Direct link to Key Benefits">​</a></h3>
<p><strong>Declarative Cross-Account Resources:</strong> Reference any resource from any account without manual coordination.</p>
<p><strong>Automatic Permission Management:</strong> IAM policies and resource policies are handled automatically.</p>
<p><strong>Consistent Deployment Experience:</strong> Multi-account deployments feel the same as single-account ones.</p>
<p><strong>Simplified Maintenance:</strong> Updates and changes don't require manual ARN extraction and policy coordination.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="looking-forward">Looking Forward<a href="https://orbits.do/blog/cross-account-cdk#looking-forward" class="hash-link" aria-label="Direct link to Looking Forward" title="Direct link to Looking Forward">​</a></h2>
<p>Cross-account resource management shouldn't be a second-class citizen in your infrastructure-as-code workflow. Tools like orbits point toward a future where account boundaries enhance security without sacrificing developer experience.</p>
<p>If you're building multi-account architectures, I encourage you to try this example and see how much simpler cross-account resource management can be. The days of manual ARN extraction and policy coordination don't have to be permanent fixtures of AWS multi-account architectures.</p>
<hr>
<p><em>Ready to try it yourself? The complete example code and setup instructions are available in the repository. Give it a spin and share your experience with cross-account resource management.</em></p>]]></content>
        <author>
            <name>Louis Dussarps</name>
            <uri>https://github.com/louisdussarps</uri>
        </author>
        <category label="aws-cdk" term="aws-cdk"/>
        <category label="orbits" term="orbits"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Infra is code]]></title>
        <id>https://orbits.do/blog/manifesto</id>
        <link href="https://orbits.do/blog/manifesto"/>
        <updated>2025-06-04T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[Infra is code!]]></summary>
        <content type="html"><![CDATA[<p><em>Infra is code!</em>
At first glance, this slogan might be the most stupid one ever read for a long time — if not on the entire planet, then at least in the web sphere. Yes, infrastructure has always been code: from the Ubuntu web server to the Cockroach database, it is nothing but code controlled by code. But if the Ops field has progressively shifted towards the notion of Infrastructure as Code, it is precisely because there is a substantial difference: the DevOps domain is better formalized as a description of reproducible artifacts rather than as a prescription of successive commands to execute.
Thus, boldly displaying this slogan <em>Infra is code!</em> on any article should make any somewhat experienced DevOps practitioner pause.</p>
<p>Yet, friend reading these lines, don’t go away so quickly! Haven’t you already felt that while DevOps improved developers’ lives with democratization of virtualization, convergence of interfaces, and unprecedented deployment speed, infrastructure itself remained, tucked away in some Git annex, a poor relative of computer code — difficult to edit, inflexible, and slow to test?
The popular wisdom among developers seems to say: the less you touch infrastructure, the better off you are.
With this, tirelessly, we arrive at a state-of-the-art where:</p>
<ul>
<li>every project <a href="https://www.reddit.com/r/devops/comments/1l8dsax/whats_eating_up_most_of_your_time_as_a_devops/" target="_blank" rel="noopener noreferrer">restarts infrastructure work</a> as if its neighbor didn’t exist</li>
<li>building a service stack remains a patchwork, a <a href="https://www.tandfonline.com/doi/full/10.1080/17530350.2023.2229347" target="_blank" rel="noopener noreferrer">conglomerate of loosely connected elements</a></li>
<li>it is difficult, <a href="https://insights.sei.cmu.edu/documents/576/2019_019_001_539335.pdf" target="_blank" rel="noopener noreferrer">without manual intervention, to redeploy an app from scratch on a new environment</a>.</li>
<li>apps are <a href="https://theses.hal.science/tel-02798770/file/90479_BRABRA_2020_archivage-4.pdf" target="_blank" rel="noopener noreferrer">hardly portable from one cloud to another</a> — and the question of sovereignty is, out of frustration, abandoned.</li>
</ul>
<p>Finally, all in all, a large part of DevOps activity remains manual, and the trust chain in the system relies on a chain of responsibility and a comprehensive understanding of the system by a few operators in the team (which is positive) rather than on appropriate tooling (which is disappointing because, as system complexity grows, <a href="https://link.springer.com/chapter/10.1007/978-3-319-74183-3_4" target="_blank" rel="noopener noreferrer">relying solely on knowledge leads to rigid systems</a>).</p>
<p>Consequently, we unanimously demand that infrastructure specifications have the same rights and level of citizenship as any other piece of code in the stack.</p>
<p>A demand that could remain dead letter if it were not accompanied by two recommendations:</p>
<p>orchestrators offer infrastructure an opportunity for liberation that it can seize to obtain its citizenship rights. The engineering platform movement has made a strong commitment in this direction and orchestration must be at the center of efforts.</p>
<p>increasingly, infrastructure benefits from being written in standard code: CDKs bear witness to the direction to follow. This allows a convergence of best practices between infrastructure and code.</p>
<p>Thus, IaC must be enhanced, orchestrated, and managed — as much as possible through standard code.
We began working under these assumptions three years ago, and it has allowed us to build numerous engineering platforms since then. As we found nothing that met our criteria, we built our own orchestration framework: Orbits (aka Orbi.ts).
It is now mature enough to fly on its own: since freedom is not won alone, we present it today to the community, hoping it can help build infrastructures and deployment pipelines that are more flexible, more robust, and more sovereign.</p>]]></content>
        <author>
            <name>Louis Dussarps</name>
            <uri>https://github.com/louisdussarps</uri>
        </author>
        <author>
            <name>Loïc Déchamps</name>
            <uri>https://github.com/ldechamps</uri>
        </author>
        <author>
            <name>Arthur Rouzoul</name>
            <uri>https://linkedin.com/in/arthurrouzoul</uri>
        </author>
        <author>
            <name>Tom Marcuzzi</name>
            <uri>https://linkedin.com/in/tom-marcuzzi</uri>
        </author>
        <author>
            <name>Sofia Chakir</name>
            <uri>https://linkedin.com/in/sofia-chakir</uri>
        </author>
        <author>
            <name>Antoine Dussarps</name>
            <uri>https://linkedin.com/in/antoine-dussarps</uri>
        </author>
        <category label="Hola" term="Hola"/>
        <category label="manifesto" term="manifesto"/>
        <category label="orbits" term="orbits"/>
    </entry>
</feed>