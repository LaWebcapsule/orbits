"use strict";(self.webpackChunkorbits_doc=self.webpackChunkorbits_doc||[]).push([[9437],{28453:(e,n,t)=>{t.d(n,{R:()=>l,x:()=>o});var i=t(96540);const s={},r=i.createContext(s);function l(e){const n=i.useContext(r);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:l(e.components),i.createElement(r.Provider,{value:n},e.children)}},35605:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>a,contentTitle:()=>o,default:()=>h,frontMatter:()=>l,metadata:()=>i,toc:()=>c});const i=JSON.parse('{"id":"documentation/guides/hello-world","title":"Hello world","description":"A practical example to help you write your first application using Orbits.","source":"@site/docs/documentation/guides/hello-world.md","sourceDirName":"documentation/guides","slug":"/documentation/guides/hello-world","permalink":"/documentation/guides/hello-world","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":0.2,"frontMatter":{"sidebar_position":0.2,"title":"Hello world"},"sidebar":"documentation","previous":{"title":"Guides","permalink":"/documentation/guides/"},"next":{"title":"CDK Cross-Account Agent Example","permalink":"/documentation/guides/cross-account-cdk"}}');var s=t(74848),r=t(28453);const l={sidebar_position:.2,title:"Hello world"},o="Hello world example",a={},c=[{value:"Scope",id:"scope",level:2},{value:"Prerequisites",id:"prerequisites",level:2},{value:"Clone this repository",id:"clone-this-repository",level:3},{value:"Project Structure",id:"project-structure",level:2},{value:"The Hello Action",id:"the-hello-action",level:2},{value:"The Hello Workflow",id:"the-hello-workflow",level:2},{value:"Type declarations",id:"type-declarations",level:3},{value:"<code>Define()</code> method",id:"define-method",level:3},{value:"Result",id:"result",level:3},{value:"The Greetings Agent",id:"the-greetings-agent",level:2},{value:"Type declarations",id:"type-declarations-1",level:3},{value:"<code>Identity</code> method",id:"identity-method",level:3},{value:"Install hook",id:"install-hook",level:3},{value:"Update hook",id:"update-hook",level:3},{value:"Uninstall hook",id:"uninstall-hook",level:3},{value:"Go further: cycle hook",id:"go-further-cycle-hook",level:3},{value:"Orbi.ts",id:"orbits",level:2},{value:"Running the sample",id:"running-the-sample",level:2},{value:"Run the Script",id:"run-the-script",level:3},{value:"Run the uninstall command",id:"run-the-uninstall-command",level:3},{value:"Using the CLI",id:"using-the-cli",level:2},{value:"Next Steps",id:"next-steps",level:2}];function d(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"hello-world-example",children:"Hello world example"})}),"\n",(0,s.jsx)(n.p,{children:"A practical example to help you write your first application using Orbits."}),"\n",(0,s.jsx)(n.h2,{id:"scope",children:"Scope"}),"\n",(0,s.jsx)(n.p,{children:"In this example, we\u2019ll create a simple \u201chello-world\u201d application. The behavior is straightforward:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"After 10 AM, say hello."}),"\n",(0,s.jsx)(n.li,{children:"Say hello only once per day."}),"\n",(0,s.jsx)(n.li,{children:"Say goodbye when the agent is uninstalled."}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,s.jsx)(n.h3,{id:"clone-this-repository",children:"Clone this repository"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Clone ",(0,s.jsx)(n.a,{href:"https://github.com/LaWebcapsule/orbits",children:"this repository"})]}),"\n",(0,s.jsx)(n.li,{children:"Go to this directory:"}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"cd samples/hello-world\n"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Install node.js dependencies:\n",(0,s.jsx)(n.code,{children:"npm i"})]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"project-structure",children:"Project Structure"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:'\u251c\u2500\u2500 src/\n\u2502   \u2514\u2500\u2500 orbits/\n\u2502       \u2514\u2500\u2500 orbi.ts # main orchestration script\n\u2502       \u251c\u2500\u2500 greetings-agent.ts # the agent that orchestrates the lifecycle of greetings\n\u2502       \u251c\u2500\u2500 hello-action.ts # an action that waits 10 am and outputs hello\n\u2502       \u2514\u2500\u2500 hello-workflow.ts # a workflow that takes a name as parameter and outputs "hello ${name}"\n\u251c\u2500\u2500 package.json\n\u2514\u2500\u2500 README.md\n'})}),"\n",(0,s.jsx)(n.h2,{id:"the-hello-action",children:"The Hello Action"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",metastring:'title="src/orbits/hello-action.ts"',children:"import { Action, ActionState } from '@orbi-ts/core';\n\nexport class HelloAction extends Action {\n    main() {\n        this.internalLog('Hello \ud83d\udc4b', { level: 'info' });\n        this.setResult('Hello');\n        return ActionState.SUCCESS;\n    }\n}\n"})}),"\n",(0,s.jsx)(n.p,{children:"This simple action logs a greeting and completes immediately."}),"\n",(0,s.jsxs)(n.p,{children:["The ",(0,s.jsx)(n.code,{children:"main()"})," method is the entry point for the action and is guaranteed to run exactly once \u2014 even across retries or resumptions. This ensures predictable and idempotent side effects."]}),"\n",(0,s.jsx)(n.h2,{id:"the-hello-workflow",children:"The Hello Workflow"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",metastring:'title="src/orbits/hello-workflow"',children:"import { Workflow } from '@orbi-ts/core';\nimport { HelloAction } from './hello-action.ts';\n\nexport class HelloWorkflow extends Workflow {\n    declare IResult: string;\n\n    declare IArgument: {\n        name: string;\n    };\n\n    async define() {\n        const prefix = await this.do('hello', new HelloAction());\n        const suffix = await this.do('name', () => {\n            return Promise.resolve(this.argument.name);\n        });\n        return `${prefix} ${suffix}`;\n    }\n}\n"})}),"\n",(0,s.jsx)(n.h3,{id:"type-declarations",children:"Type declarations"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:"declare;\nIResult: string;\n\ndeclare;\nIArgument: {\n    name: string;\n}\n"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"IResult"})," defines the return type of the workflow."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"IArgument"})," defines the expected input arguments."]}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:"const result = await this.do('hello', new HelloWorkflow()); // `result` is typed as string\n"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:"new HelloWorkflow().setArgument({ name: 'Alice' }); // type-checked argument\n"})}),"\n",(0,s.jsxs)(n.h3,{id:"define-method",children:[(0,s.jsx)(n.code,{children:"Define()"})," method"]}),"\n",(0,s.jsxs)(n.p,{children:["The ",(0,s.jsx)(n.code,{children:"define()"})," method describes the logic of the workflow and must use ",(0,s.jsx)(n.code,{children:"this.do()"})," for any asynchronous operations. Directly using raw promises is discouraged."]}),"\n",(0,s.jsx)(n.p,{children:"Example illustrating execution behavior:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:'async define() {\n    console.log("Called multiple times");\n    await this.do("log", () => {\n        console.log("Called only once");\n        return Promise.resolve();\n    });\n}\n'})}),"\n",(0,s.jsxs)(n.p,{children:["This approach aligns with the ",(0,s.jsx)(n.a,{href:"https://microservices.io/patterns/data/saga.html",children:"SAGA principle"}),".\nSee the ",(0,s.jsx)(n.a,{href:"/documentation/core-concepts/workflow#the-do-method",children:"Orbits Core documentation"})," for more on ",(0,s.jsx)(n.code,{children:"this.do()"})]}),"\n",(0,s.jsx)(n.h3,{id:"result",children:"Result"}),"\n",(0,s.jsxs)(n.p,{children:["At the end of ",(0,s.jsx)(n.code,{children:"define()"}),", we return a string which becomes the result of the workflow."]}),"\n",(0,s.jsx)(n.h2,{id:"the-greetings-agent",children:"The Greetings Agent"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",metastring:"title='src/orbits/greeting-agent.ts'",children:"export class GreetingAgent extends Agent {\n    declare IResult: string;\n\n    declare IArgument: {\n        name: string;\n        date: string;\n    } & Agent['IArgument'];\n\n    identity() {\n        return `${this.argument.name}-${this.argument.date}`;\n    }\n\n    async defineInstall() {\n        const greeting = await this.do(\n            'greeting',\n            new HelloWorkflow().setArgument({\n                name: this.argument.name,\n            })\n        );\n        await this.do('display-greeting', () => {\n            this.internalLog(`${greeting}  \ud83d\udc4b\ud83d\udc4b\ud83d\udc4b`, { level: 'info' });\n            return Promise.resolve();\n        });\n    }\n\n    async defineUpdate() {\n        //do nothing\n        this.internalLog(`(I have already seen you.)\ud83d\udc7b`, { level: 'info' });\n    }\n\n    async defineUninstall() {\n        await this.do('display-goodbye', () => {\n            this.internalLog(\n                `Goodbye my dear friend ${this.argument.name} \ud83d\udc4b\ud83d\udc4b\ud83d\udc4b`,\n                { level: 'info' }\n            );\n            return Promise.resolve();\n        });\n    }\n}\n"})}),"\n",(0,s.jsx)(n.h3,{id:"type-declarations-1",children:"Type declarations"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:'declare IResult: string;\n\ndeclare IArgument: {\n    name: string;\n    date: string\n} & Agent["IArgument"]\n'})}),"\n",(0,s.jsx)(n.p,{children:"Same as for workflows, this enables type checking and autocompletion."}),"\n",(0,s.jsxs)(n.h3,{id:"identity-method",children:[(0,s.jsx)(n.code,{children:"Identity"})," method"]}),"\n",(0,s.jsxs)(n.p,{children:["The ",(0,s.jsx)(n.code,{children:"identity()"})," method uniquely identifies a agent instance.\nIf two instances share the same identity, they refer to the same real-world object and will share state."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:"identity() {\n    return `${this.argument.name}-${this.argument.date}`;\n}\n"})}),"\n",(0,s.jsx)(n.p,{children:"That means that a greeting agent is unique by name and by date."}),"\n",(0,s.jsx)(n.h3,{id:"install-hook",children:"Install hook"}),"\n",(0,s.jsx)(n.p,{children:"Runs once when the agent is first created."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:"async defineInstall() {\n    const greeting = await this.do(\n        'greeting',\n        new HelloWorkflow().setArgument({\n            name: this.argument.name,\n        })\n    );\n    await this.do('display-greeting', () => {\n        this.internalLog(`${greeting}  \ud83d\udc4b\ud83d\udc4b\ud83d\udc4b`, {\xa0level: 'info' });\n        return Promise.resolve();\n    });\n}\n"})}),"\n",(0,s.jsx)(n.h3,{id:"update-hook",children:"Update hook"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:"async defineUpdate() {\n    //do nothing\n    this.internalLog(`(I have already seen you.)\ud83d\udc7b`, {\xa0level: 'info' });\n}\n"})}),"\n",(0,s.jsx)(n.p,{children:"Runs every time the agent is reused with the same identity."}),"\n",(0,s.jsx)(n.h3,{id:"uninstall-hook",children:"Uninstall hook"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:"async defineUninstall() {\n    await this.do('display-goodbye', () => {\n        this.internalLog(`Goodbye my dear friend ${this.argument.name} \ud83d\udc4b\ud83d\udc4b\ud83d\udc4b`, {\xa0level: 'info' });\n        return Promise.resolve();\n    });\n}\n"})}),"\n",(0,s.jsx)(n.p,{children:"To trigger it:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:"    new GreetingAgent().setArgument(...).setCommand('Uninstall');\n"})}),"\n",(0,s.jsx)(n.h3,{id:"go-further-cycle-hook",children:"Go further: cycle hook"}),"\n",(0,s.jsxs)(n.p,{children:["We don't use it in our sample, but agents offer the possibility to launch a cycle command at fixed intervals.\nThis can be useful for recurring tasks like polling, cleanup, or reporting.\nPlease ",(0,s.jsx)(n.a,{href:"/documentation/core-concepts/agent#cycle",children:"see the documentation"})," to learn more."]}),"\n",(0,s.jsx)(n.h2,{id:"orbits",children:"Orbi.ts"}),"\n",(0,s.jsx)(n.p,{children:"In orbi.ts, we do:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",metastring:'title="src/orbits/orbi.ts"',children:"import { Action, ActionRuntime, ActionState } from '@orbi-ts/core';\nimport { GreetingAgent } from './greetings-agent.ts';\n\nActionRuntime.activeRuntime.waitForBootstrap.then(async () => {\n    const greetingOfTheDay = new GreetingAgent().setArgument({\n        name: 'John Doe',\n        date: String(new Date().toISOString().split('T')[0]),\n    });\n    greetingOfTheDay.save();\n    await Action.trackActionAsPromise(greetingOfTheDay, [\n        ActionState.SUCCESS,\n        ActionState.ERROR,\n    ]);\n\n    const greetingOfTheDay2 = new GreetingAgent().setArgument({\n        name: 'John Doe',\n        date: String(new Date().toISOString().split('T')[0]),\n    });\n    greetingOfTheDay2.save();\n    await Action.trackActionAsPromise(greetingOfTheDay2, [\n        ActionState.SUCCESS,\n        ActionState.ERROR,\n    ]);\n});\n"})}),"\n",(0,s.jsx)(n.p,{children:"We launch the same Agent twice.\nThis shows evidence that:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"during the first run, you will see greeting in the logs"}),"\n",(0,s.jsx)(n.li,{children:'during the second run, you will only see the "I have already seen you" in the logs'}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"running-the-sample",children:"Running the sample"}),"\n",(0,s.jsx)(n.h3,{id:"run-the-script",children:"Run the Script"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:'export ORBITS_DB__MONGO__URL="your-mongo-cluster"\nnpx tsx src/orbits/orbi.ts\n'})}),"\n",(0,s.jsx)(n.p,{children:"Expected Output"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"First run: logs the greeting"}),"\n",(0,s.jsx)(n.li,{children:'Subsequent runs: logs "I have already seen you"'}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"run-the-uninstall-command",children:"Run the uninstall command"}),"\n",(0,s.jsxs)(n.p,{children:["Edit ",(0,s.jsx)(n.code,{children:"orbi.ts"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",metastring:'title="src/orbits/orbi.ts"',children:'ActionRuntime.activeRuntime.waitForBootstrap.then(async () => {\n    const greetingOfTheDay = new GreetingAgent().setArgument({\n        name: "John Doe",\n        date: String(new Date().toISOString().split("T")[0])\n    }).setCommand("Uninstall")\n    greetingOfTheDay.save();\n)\n'})}),"\n",(0,s.jsx)(n.p,{children:"Then run:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:'export ORBITS_DB__MONGO__URL="your-mongo-cluster"\nnpx tsx src/orbits/orbi.ts\n'})}),"\n",(0,s.jsx)(n.p,{children:"You should see the goodbye message in the logs."}),"\n",(0,s.jsx)(n.h2,{id:"using-the-cli",children:"Using the CLI"}),"\n",(0,s.jsx)(n.p,{children:"Instead of running the script above, you can directly run the agent from the command line using the CLI:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"running the agent"}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"orbits-cli actions run MyGreetings name='John Doe' date='01-01-01' -f src/orbits/greeting-agent.ts -l\n"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"uninstalling the agent"}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"orbits-cli actions run MyGreetings name='John Doe' date='01-01-01' commandName=Uninstall -f src/orbits/greeting-agent.ts -l\n"})}),"\n",(0,s.jsx)(n.h2,{id:"next-steps",children:"Next Steps"}),"\n",(0,s.jsxs)(n.admonition,{title:"What's Next?",type:"tip",children:[(0,s.jsx)(n.p,{children:"Here are three recommended next steps to continue your journey:"}),(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsxs)(n.strong,{children:["\ud83e\udde9 ",(0,s.jsx)(n.a,{href:"/documentation/guides/cross-account-cdk",children:"Cross-account cdk examples"})]})," - Show how to use infrastructure templates in conjunction with orbits"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsxs)(n.strong,{children:["\u2699\ufe0f ",(0,s.jsx)(n.a,{href:"/documentation/core-concepts/",children:"Core concepts"})]})," - Master the fundamental architecture principles and design patterns that power Orbits"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsxs)(n.strong,{children:["\ud83d\udee4\ufe0f ",(0,s.jsx)(n.a,{href:"/documentation/guides/",children:"Guides"})]})," - Explore hands-on tutorials ranging from beginner-friendly to advanced implementation techniques"]}),"\n"]})]})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}}}]);