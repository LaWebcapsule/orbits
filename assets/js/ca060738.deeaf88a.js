"use strict";(self.webpackChunkorbits_doc=self.webpackChunkorbits_doc||[]).push([[7759],{28453:(e,n,s)=>{s.d(n,{R:()=>l,x:()=>o});var t=s(96540);const r={},i=t.createContext(r);function l(e){const n=t.useContext(i);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:l(e.components),t.createElement(i.Provider,{value:n},e.children)}},30709:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>a,contentTitle:()=>o,default:()=>u,frontMatter:()=>l,metadata:()=>t,toc:()=>c});const t=JSON.parse('{"id":"documentation/guides/small-cdk8s-deployment","title":"CDK8S simple deployment","description":"A practical example demonstrating how to manage kube resources through CDK8S and orbits.","source":"@site/docs/documentation/guides/small-cdk8s-deployment.md","sourceDirName":"documentation/guides","slug":"/documentation/guides/small-cdk8s-deployment","permalink":"/documentation/guides/small-cdk8s-deployment","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":3,"frontMatter":{"sidebar_position":3},"sidebar":"documentation","previous":{"title":"CDK Cross-Account Agent Example","permalink":"/documentation/guides/cross-account-cdk"},"next":{"title":"An express server over your agents","permalink":"/documentation/guides/express-server"}}');var r=s(74848),i=s(28453);const l={sidebar_position:3},o="CDK8S simple deployment",a={},c=[{value:"Problem statement",id:"problem-statement",level:2},{value:"Prerequisites",id:"prerequisites",level:2},{value:"Clone this repository",id:"clone-this-repository",level:3},{value:"Setup kube environment",id:"setup-kube-environment",level:3},{value:"Deployment",id:"deployment",level:2},{value:"Verify the result",id:"verify-the-result",level:3},{value:"<em>Note</em>",id:"note",level:4},{value:"Cleanup",id:"cleanup",level:2},{value:"Project Structure",id:"project-structure",level:2}];function d(e){const n={a:"a",blockquote:"blockquote",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,i.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"cdk8s-simple-deployment",children:"CDK8S simple deployment"})}),"\n",(0,r.jsx)(n.p,{children:"A practical example demonstrating how to manage kube resources through CDK8S and orbits."}),"\n",(0,r.jsx)(n.h2,{id:"problem-statement",children:"Problem statement"}),"\n",(0,r.jsxs)(n.p,{children:["CDK8S is powerful for defining Kubernetes resources, but it lacks built-in support for programmatic deployment, rollback mechanisms, or exposing outputs.\nThe Orbits CDK8S integration adds a ",(0,r.jsx)(n.a,{href:"https://www.wwt.com/blog/what-is-model-driven-orchestration-and-why-would-i-use-it",children:"model-driven orchestration"})," layer, making CDK8S fully operational in automated workflows.\nWith ",(0,r.jsx)(n.code,{children:"Cdk8sAgent"})," from Orbits, you gain:"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Programmatic deployment of your CDK8S charts;"}),"\n",(0,r.jsx)(n.li,{children:"Automatic rollback in case of deployment failure;"}),"\n",(0,r.jsx)(n.li,{children:"Pruning of obsolete resources removed from your charts;"}),"\n",(0,r.jsx)(n.li,{children:"Output support to expose selected resource values for use in other stacks or systems;"}),"\n",(0,r.jsx)(n.li,{children:"Fully customizable model-driven orchestrator."}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"Beyond deployment, Orbits enables you to:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Consistently deploy your charts with built-in rollback mechanisms\n\u2192 Example: If a deployment fails due to a misconfigured resource, Orbits will automatically revert to the previous stable state."}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Extend your IaC logic, for example, by fetching the IP of a load balancer via SDK and updating your DNS provider\n\u2192 Example: After deploying an Ingress, Orbits can retrieve the LoadBalancer IP and automatically update a Route53 DNS record."}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Trigger redeployments automatically in response to specific events\n\u2192 Example: When a secret in AWS Secrets Manager is rotated, Orbits can detect the change and redeploy affected charts to refresh the credentials."}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"This sample demonstrates the use of Orbits on a minimal CDK8S use case."}),"\n",(0,r.jsx)(n.h2,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,r.jsx)(n.h3,{id:"clone-this-repository",children:"Clone this repository"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Clone ",(0,r.jsx)(n.a,{href:"https://github.com/LaWebcapsule/orbits",children:"this repository"})]}),"\n",(0,r.jsx)(n.li,{children:"Go to this directory:"}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"cd samples/cdk8s-deployment\n"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Install node.js dependencies:"}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"  npm i\n"})}),"\n",(0,r.jsx)(n.h3,{id:"setup-kube-environment",children:"Setup kube environment"}),"\n",(0,r.jsx)(n.p,{children:"You'll need access to a Kubernetes environment."}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"kubectl"})," must be installed and properly configured."]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"This sample will use your current Kubernetes context, so ensure you're connected to the correct cluster before running any commands."}),"\n",(0,r.jsx)(n.h2,{id:"deployment",children:"Deployment"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Define your mongo url:"}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"export ORBITS_DB__MONGO__URL=your-mongo-url\n"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Deploy Cdk8s basic stack with the CLI:"}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"orbits-cli actions run BasicAgent stackName=cdk8s-basic -f src/orbits/orbi.ts --local-worker\n"})}),"\n",(0,r.jsx)(n.p,{children:"or run:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"npx tsx src/orbits/orbi.ts\n"})}),"\n",(0,r.jsx)(n.p,{children:"This command will:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Create a new Kubernetes namespace"}),"\n",(0,r.jsx)(n.li,{children:"Deploy a scheduled Job named hello-world that runs daily at 10:00 AM"}),"\n",(0,r.jsx)(n.li,{children:"Output the namespace and job names in the console"}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"verify-the-result",children:"Verify the result"}),"\n",(0,r.jsx)(n.p,{children:"Get the namespace:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"kubectl get namespaces -l orbits/stackName=cdk8s-basic\n"})}),"\n",(0,r.jsx)(n.p,{children:"Get the job:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"export NS=$(kubectl get ns -l orbits/stackName=cdk8s-basic -o jsonpath='{.items[0].metadata.name}')\n\nkubectl get all --namespace $NS -l orbits/stackName=cdk8s-basic\n"})}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsx)(n.h4,{id:"note",children:(0,r.jsx)(n.em,{children:"Note"})}),"\n",(0,r.jsx)(n.p,{children:"You can get the created namespace and job names using the CLI:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'orbits-cli actions get -f \'{"identity":"{\\"stackName\\":\\"cdk8s-basic\\"}", "actionRef":"BasicAgent"}\' -o \'{"createdAt":1}\' -j | jq \'.[0].result.namespace\'\n'})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'orbits-cli actions get -f \'{"identity":"{\\"stackName\\":\\"cdk8s-basic\\"}", "actionRef":"BasicAgent"}\' -o \'{"createdAt":1}\' -j | jq \'.[0].result.cronJobName\'\n'})}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"cleanup",children:"Cleanup"}),"\n",(0,r.jsx)(n.p,{children:"To remove all deployed resources from both accounts:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"export CDK8S_COMMAND=uninstall\norbits-cli actions run BasicAgent commandName=$CDK8S_COMMAND stackName=cdk8s-basic -f src/orbits/orbi.ts --local-worker\n"})}),"\n",(0,r.jsx)(n.p,{children:"or run:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"npx tsx src/orbits/orbi.ts\n"})}),"\n",(0,r.jsx)(n.h2,{id:"project-structure",children:"Project Structure"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"\u251c\u2500\u2500 src/\n\u2502   \u251c\u2500\u2500 orbits/\n\u2502   \u2502   \u251c\u2500\u2500 orbi.ts # Main orchestration script\n\u2502   \u2502   \u2514\u2500\u2500 basic-agent.ts # Basic agent definition\n\u2502   \u2514\u2500\u2500 cdk/ # CDK8S chart definitions\n\u2502       \u2514\u2500\u2500 basic-cdk8s.ts # basic chart definition\n\u251c\u2500\u2500 package.json\n\u2514\u2500\u2500 README.md\n"})})]})}function u(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}}}]);