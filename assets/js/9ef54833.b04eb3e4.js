"use strict";(self.webpackChunkorbits_doc=self.webpackChunkorbits_doc||[]).push([[2400],{28453:(e,n,t)=>{t.d(n,{R:()=>i,x:()=>a});var s=t(96540);const o={},r=s.createContext(o);function i(e){const n=s.useContext(r);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:i(e.components),s.createElement(r.Provider,{value:n},e.children)}},34981:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>a,default:()=>p,frontMatter:()=>i,metadata:()=>s,toc:()=>l});const s=JSON.parse('{"id":"documentation/guides/express-server","title":"An express server over your agents","description":"Install @orbi-ts/core and @orbi-ts/fuel.","source":"@site/docs/documentation/guides/express-server.md","sourceDirName":"documentation/guides","slug":"/documentation/guides/express-server","permalink":"/documentation/guides/express-server","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":4,"frontMatter":{"sidebar_position":4},"sidebar":"documentation","previous":{"title":"CDK8S simple deployment","permalink":"/documentation/guides/small-cdk8s-deployment"},"next":{"title":"Microservices Orchestration Example","permalink":"/documentation/guides/microservices-orchestration"}}');var o=t(74848),r=t(28453);const i={sidebar_position:4},a="An express server over your agents",c={},l=[{value:"Configure persistent storage",id:"configure-persistent-storage",level:2},{value:"Consume the action in your app",id:"consume-the-action-in-your-app",level:2},{value:"Track the state of your action",id:"track-the-state-of-your-action",level:2},{value:"Load your app",id:"load-your-app",level:2}];function d(e){const n={code:"code",h1:"h1",h2:"h2",header:"header",p:"p",pre:"pre",...(0,r.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.header,{children:(0,o.jsx)(n.h1,{id:"an-express-server-over-your-agents",children:"An express server over your agents"})}),"\n",(0,o.jsx)(n.h1,{id:"install",children:"Install"}),"\n",(0,o.jsxs)(n.p,{children:["Install ",(0,o.jsx)(n.code,{children:"@orbi-ts/core"})," and ",(0,o.jsx)(n.code,{children:"@orbi-ts/fuel"}),"."]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"npm install @orbi-ts/core @orbi-ts/fuel --save\n"})}),"\n",(0,o.jsx)(n.p,{children:"Install it with yarn:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"yarn add @orbi-ts/core @orbi-ts/fuel\n"})}),"\n",(0,o.jsx)(n.h1,{id:"write-you-first-action",children:"Write you first action"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-ts",metastring:"title='src/orbits/my-action.ts'",children:"import { Action } from '@orbi-ts/core';\n\nexport class MyAction extends Action {\n    IArgument: {};\n\n    IResult: {};\n\n    main() {\n        this.setResult('hello!');\n        return ActionState.Success;\n    }\n}\n"})}),"\n",(0,o.jsx)(n.h1,{id:"import-your-action-in-your-code",children:"Import your action in your code"}),"\n",(0,o.jsx)(n.h2,{id:"configure-persistent-storage",children:"Configure persistent storage"}),"\n",(0,o.jsx)(n.p,{children:"You will need a mongodb connection to store the state of your action."}),"\n",(0,o.jsxs)(n.p,{children:["Once you have a valid mongodb url, please create an ",(0,o.jsx)(n.code,{children:"ActionRuntime"})," with the mongodb connection string."]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-ts",metastring:"title='src/orbits/action-app.ts'",children:"const db = {\n    protocol: 'mongodb+srv',\n    url: process.env['MONGO_URL'],\n    name: 'orbits-test',\n    connectQsParams: '?retryWrites=true&w=majority',\n};\n\nnew ActionRuntime({\n    db: {\n        mongo: {\n            url: `${db.protocol || 'mongodb'}://${db.url}/${db.name}${db.connectQsParams}`,\n            opts: {},\n        },\n    },\n});\n"})}),"\n",(0,o.jsx)(n.h2,{id:"consume-the-action-in-your-app",children:"Consume the action in your app"}),"\n",(0,o.jsx)(n.p,{children:"For example, if you want to consume the action in an express server:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-ts",children:"import express, { Request, Response } from 'express';\n\nconst app = express();\nconst port = 3000;\n\napp.get('/hello-world', async (req: Request, res: Response) => {\n    const action = new MyAction();\n    await action.save();\n    return res.send(action);\n});\n"})}),"\n",(0,o.jsx)(n.h2,{id:"track-the-state-of-your-action",children:"Track the state of your action"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-ts",metastring:"title='src/orbits/app.ts'",children:"import express, { Request, Response } from 'express';\nimport { Action, ActionState } from '@orbi-ts/core';\n\nconst app = express();\nconst port = 3000;\n\napp.get('/hello-world', async (req: Request, res: Response) => {\n    const action = new MyAction();\n    await action.save();\n    await Action.trackActionAsPromise(action, [\n        ActionState.SUCCESS,\n        ActionState.ERROR,\n    ]);\n    return res.send(action);\n});\n"})}),"\n",(0,o.jsx)(n.h2,{id:"load-your-app",children:"Load your app"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-ts",metastring:"title='src/server.ts'",children:"import express, { Request, Response } from 'express';\nimport { Action, ActionRuntime, ActionState } from '@orbi-ts/core';\n\nconst app = express();\nconst port = 3000;\n\napp.get('/hello-world', async (req: Request, res: Response) => {\n    const action = new MyAction();\n    await action.save();\n    await Action.trackActionAsPromise(action, [\n        ActionState.SUCCESS,\n        ActionState.ERROR,\n    ]);\n    return res.send(action);\n});\n\napp.listen(port, async () => {\n    console.log(`Server is running at http://localhost:${port}`);\n    await ActionRuntime.activeRuntime;\n    console.log(`orbits app is able to register actions`);\n});\n"})})]})}function p(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(d,{...e})}):d(e)}}}]);