"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[12],{379:(e,t,n)=>{n.r(t),n.d(t,{DEFAULT_RUM_PROFILER_CONFIGURATION:()=>g,createRumProfiler:()=>b});var s=n(886),r=n(9336),o=n(4564),i=n(2182),a=n(9853),c=n(3001),l=n(5909);const u=new Map;function p(e){return u.get(e)}function d(e){for(const t of u.keys())t<e&&u.delete(t)}function f({rawRumEvent:e,startTime:t}){if(e.type!==l.bb.LONG_TASK)return;!function(e,t){u.set(t,e)}(e.long_task.id,t)}var m=n(2925);const v={sendProfile:(e,t,n,s)=>{const o=function(e,t,n,s){const o=t.tags,i=function(e,t,n){const s={application:{id:t}};n&&(s.session={id:n});const r=Array.from(new Set(e.views.map(e=>e.viewId)));r.length&&(s.view={id:r});const o=e.longTasks.map(e=>e.id).filter(e=>void 0!==e);o.length&&(s.long_task={id:o});return s}(e,n,s),a=function(e){const t=e.concat(["language:javascript","runtime:chrome","family:chrome","host:browser"]);return t}(o),c={...i,attachments:["wall-time.json"],start:new Date(e.startClocks.timeStamp).toISOString(),end:new Date(e.endClocks.timeStamp).toISOString(),family:"chrome",runtime:"chrome",format:"json",version:4,tags_profiler:a.join(","),_dd:{clock_drift:(0,r.TP)()}};return c}(e,t,n,s),i=function(e,t){const n=new Blob([JSON.stringify(e)],{type:"application/json"}),s=new FormData;return s.append("event",new Blob([JSON.stringify(t)],{type:"application/json"}),"event.json"),s.append("wall-time.json",n,"wall-time.json"),{data:s,bytesCount:0}}(e,o),a=t.build("fetch",i);return(0,m.A2)("Sending profile to public profiling intake",{profilingIntakeURL:a,applicationId:n,sessionId:s}),fetch(a,{body:i.data,method:"POST"})}},g={sampleIntervalMs:10,collectIntervalMs:6e4,minProfileDurationMs:5e3,minNumberOfSamples:50};function b(e,t,n,u,m=g){const b=(0,l.s5)(l.do.LONG_ANIMATION_FRAME);let w;const k=[];let h={state:"stopped"};function y(){const n=(0,o.V)().Profiler;if(!n)throw u.set({status:"error",error_reason:"not-supported-by-browser"}),new Error("RUM Profiler is not supported in this browser.");I(h).catch(i.Dx);const{cleanupTasks:s,observer:l}=function(n){if("running"===n.state)return{cleanupTasks:n.cleanupTasks,observer:n.observer};const s=[];let r;if(e.trackLongTasks){r=new PerformanceObserver(_),r.observe({entryTypes:[b?"long-animation-frame":"longtask"]});const e=t.subscribe(12,e=>{f(e)});s.push(()=>null==r?void 0:r.disconnect()),s.push(e.unsubscribe)}const o=t.subscribe(2,e=>{M({viewId:e.id,viewName:e.name,startClocks:e.startClocks})});return s.push(o.unsubscribe),{cleanupTasks:s,observer:r}}(h);let p;try{p=new n({sampleInterval:m.sampleIntervalMs,maxBufferSize:Math.round(1.5*m.collectIntervalMs/m.sampleIntervalMs)})}catch(d){return void(d instanceof Error&&d.message.includes("disabled by Document Policy")?(a.Vy.warn("[DD_RUM] Profiler startup failed. Ensure your server includes the `Document-Policy: js-profiling` response header when serving HTML pages.",d),u.set({status:"error",error_reason:"missing-document-policy-header"})):u.set({status:"error",error_reason:"unexpected-exception"}))}u.set({status:"running",error_reason:void 0}),h={state:"running",startClocks:(0,r.M8)(),profiler:p,timeoutId:(0,c.wg)(y,m.collectIntervalMs),longTasks:[],views:[],cleanupTasks:s,observer:l},M(w),p.addEventListener("samplebufferfull",S)}async function I(t){var s,o;if("running"!==t.state)return;O(null!==(o=null===(s=t.observer)||void 0===s?void 0:s.takeRecords())&&void 0!==o?o:[]),(0,c.DJ)(t.timeoutId),t.profiler.removeEventListener("samplebufferfull",S);const{startClocks:a,longTasks:l,views:u}=t,p=(0,r.M8)();await t.profiler.stop().then(t=>{const s=(0,r.M8)(),o=l.length>0,c=(0,r.vk)(a.timeStamp,s.timeStamp)<m.minProfileDurationMs,f=function(e){let t=0;for(const n of e)void 0!==n.stackId&&t++;return t}(t.samples)<m.minNumberOfSamples;(o||!c&&!f)&&(!function(t){var s;const r=null===(s=n.findTrackedSession())||void 0===s?void 0:s.id;v.sendProfile(t,e.profilingEndpointBuilder,e.applicationId,r).catch(i.Dx)}(Object.assign(t,{startClocks:a,endClocks:s,clocksOrigin:(0,r.Oc)(),longTasks:l,views:u,sampleInterval:m.sampleIntervalMs})),d(p.relative))}).catch(i.Dx)}async function T(e){"running"===h.state&&(h.cleanupTasks.forEach(e=>e()),await I(h),h={state:e})}function M(e){"running"===h.state&&e&&h.views.push(e)}function S(){y()}function _(e){O(e.getEntries())}function O(e){if("running"===h.state)for(const t of e){if(t.duration<m.sampleIntervalMs)continue;const e=(0,r.FR)(t.startTime),n=p(e.relative);h.longTasks.push({id:n,duration:t.duration,entryType:t.entryType,startClocks:e})}}function C(){"hidden"===document.visibilityState&&"running"===h.state?T("paused").catch(i.Dx):"visible"===document.visibilityState&&"paused"===h.state&&y()}function D(){y()}return{start:function(t){"running"!==h.state&&(w=t?{startClocks:t.startClocks,viewId:t.id,viewName:t.name}:void 0,k.push((0,s.q)(e,window,"visibilitychange",C).stop,(0,s.q)(e,window,"beforeunload",D).stop),y())},stop:async function(){await T("stopped"),k.forEach(e=>e()),d((0,r.M8)().relative),u.set({status:"stopped",error_reason:void 0})},isStopped:function(){return"stopped"===h.state},isRunning:function(){return"running"===h.state},isPaused:function(){return"paused"===h.state}}}}}]);