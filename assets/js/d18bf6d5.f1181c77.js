"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[9437],{5605:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>a,contentTitle:()=>l,default:()=>h,frontMatter:()=>o,metadata:()=>s,toc:()=>c});const s=JSON.parse('{"id":"documentation/guides/hello-world","title":"Hello world","description":"A practical example to help you write your first application using Orbits.","source":"@site/docs/documentation/guides/hello-world.md","sourceDirName":"documentation/guides","slug":"/documentation/guides/hello-world","permalink":"/documentation/guides/hello-world","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":0.2,"frontMatter":{"sidebar_position":0.2,"title":"Hello world"},"sidebar":"tutorialSidebar","previous":{"title":"Guides","permalink":"/documentation/guides/"},"next":{"title":"CDK Cross-Account Resource Example","permalink":"/documentation/guides/cross-account-cdk"}}');var i=t(4848),r=t(8453);const o={sidebar_position:.2,title:"Hello world"},l="Hello world example",a={},c=[{value:"Scope",id:"scope",level:2},{value:"Prerequisites",id:"prerequisites",level:2},{value:"Clone this repository",id:"clone-this-repository",level:3},{value:"Project Structure",id:"project-structure",level:2},{value:"The Hello Action",id:"the-hello-action",level:2},{value:"The Hello Workflow",id:"the-hello-workflow",level:2},{value:"Type declarations",id:"type-declarations",level:3},{value:"Define() method",id:"define-method",level:3},{value:"Result",id:"result",level:3},{value:"The Greetings Resources",id:"the-greetings-resources",level:2},{value:"Type declarations",id:"type-declarations-1",level:3},{value:"Identity method",id:"identity-method",level:3},{value:"Install hook",id:"install-hook",level:3},{value:"Update hook",id:"update-hook",level:3},{value:"Uninstall hook",id:"uninstall-hook",level:3},{value:"Go further : cycle hook",id:"go-further--cycle-hook",level:3},{value:"Orbi.ts",id:"orbits",level:2},{value:"Running the sample",id:"running-the-sample",level:2},{value:"Run the Script",id:"run-the-script",level:3},{value:"Run the uninstall command",id:"run-the-uninstall-command",level:3},{value:"Next Steps",id:"next-steps",level:2}];function d(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"hello-world-example",children:"Hello world example"})}),"\n",(0,i.jsx)(n.p,{children:"A practical example to help you write your first application using Orbits."}),"\n",(0,i.jsx)(n.h2,{id:"scope",children:"Scope"}),"\n",(0,i.jsx)(n.p,{children:"In this example, we\u2019ll create a simple \u201chello-world\u201d application. The behavior is straightforward:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"After 10 AM, say hello"}),"\n",(0,i.jsx)(n.li,{children:"Say hello only once per day"}),"\n",(0,i.jsx)(n.li,{children:"Say goodbye when the resource is uninstalled"}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,i.jsx)(n.h3,{id:"clone-this-repository",children:"Clone this repository"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Clone this repository"}),"\n",(0,i.jsxs)(n.li,{children:["Install npm dependencies :\n",(0,i.jsx)(n.code,{children:"npm i"})]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"project-structure",children:"Project Structure"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'\u251c\u2500\u2500 src/\n\u2502   \u251c\u2500\u2500 orbits/\n\u2502   \u2502   \u2514\u2500\u2500 orbi.ts # Main orchestration script\n\u2502   \u2502   \u251c\u2500\u2500 greetings-resource.ts # the resource that orchestrate the lifecycle of greetings\n\u2502   \u2502   \u251c\u2500\u2500 hello-action.ts # An action that wait 10 am and says hello\n\u2502   \u2502   \u251c\u2500\u2500 hello-workflow.ts # A workflow that take in parameter a name and say "hello ${name}"\n\u251c\u2500\u2500 package.json\n\u2514\u2500\u2500 README.md\n'})}),"\n",(0,i.jsx)(n.h2,{id:"the-hello-action",children:"The Hello Action"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",metastring:'title="src/orbits/hello-action.ts"',children:"import { Action, ActionState } from '@wbce/orbits-core';\n\n\n\nexport class HelloAction extends Action{\n\n    main(){\n        console.log('Hello \ud83d\udc4b');\n        this.setResult('Hello');\n        return ActionState.SUCCESS\n    }\n\n}\n"})}),"\n",(0,i.jsx)(n.p,{children:"This simple action logs a greeting and completes immediately."}),"\n",(0,i.jsx)(n.p,{children:"The main() method is the entry point for the action and is guaranteed to run exactly once\u2014even across retries or resumptions. This ensures predictable and idempotent side effects."}),"\n",(0,i.jsx)(n.h2,{id:"the-hello-workflow",children:"The Hello Workflow"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",metastring:'title="src/orbits/hello-workflow"',children:'import { Workflow } from "@wbce/orbits-core";\nimport { HelloAction } from "./hello-action.ts";\n\n\n\nexport class HelloWorkflow extends Workflow{\n\n    declare IResult: string;\n\n    declare IArgument: {\n        name: string;\n    }\n\n    async define(){\n        const prefix = await this.do("hello", new HelloAction());\n        const suffix = await this.do("name", ()=>{\n            return Promise.resolve(this.argument.name);\n        })\n        return `${prefix} ${suffix}`;\n    }\n}\n'})}),"\n",(0,i.jsx)(n.h3,{id:"type-declarations",children:"Type declarations"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"declare IResult: string;\n\ndeclare IArgument: {\n    name: string;\n}\n"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"IResult"})," defines the return type of the workflow."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"IArgument"})," defines the expected input arguments."]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:'const result = await this.do("hello", new HelloWorkflow()); // `result` is typed as string\n'})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:'    new HelloWorkflow().setArgument({ name: "Alice" }); // type-checked argument\n'})}),"\n",(0,i.jsx)(n.h3,{id:"define-method",children:"Define() method"}),"\n",(0,i.jsx)(n.p,{children:"The define() method describes the logic of the workflow and must use this.do() for any asynchronous operations. Directly using raw promises is discouraged."}),"\n",(0,i.jsx)(n.p,{children:"Example illustrating execution behavior:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:'async define() {\n    console.log("Called multiple times");\n    await this.do("log", () => {\n        console.log("Called only once");\n        return Promise.resolve();\n    });\n}\n'})}),"\n",(0,i.jsxs)(n.p,{children:["This approach aligns with the ",(0,i.jsx)(n.a,{href:"https://microservices.io/patterns/data/saga.html",children:"SAGA principle"}),".\nSee the ",(0,i.jsx)(n.a,{href:"/documentation/core-concepts/workflow#the-do-method",children:"Orbits Core documentation"})," for more on ",(0,i.jsx)(n.code,{children:"this.do()"})]}),"\n",(0,i.jsx)(n.h3,{id:"result",children:"Result"}),"\n",(0,i.jsx)(n.p,{children:"At the end of define(), we return a string which becomes the result of the workflow."}),"\n",(0,i.jsx)(n.h2,{id:"the-greetings-resources",children:"The Greetings Resources"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",metastring:"title='src/orbits/greeting-resource.ts'",children:'export class GreetingResource extends Resource {\n\n    declare IResult: string;\n\n    declare IArgument: {\n        name: string;\n        date: string\n    } & Resource["IArgument"]\n\n    identity() {\n        return `${this.argument.name}-${this.argument.date}`;\n    }\n\n    async defineInstall() {\n        const greeting = await this.do("greeting", new HelloWorkflow().setArgument({\n            name: this.argument.name\n        }));\n        await this.do("display-greeting", ()=>{\n            console.log(`${greeting}  \ud83d\udc4b\ud83d\udc4b\ud83d\udc4b`);\n            return Promise.resolve();\n        })\n    }\n\n    async defineUpdate() {\n        //do nothing\n        console.log(`(I have already seen you.)\ud83d\udc7b`);\n    }\n\n    async defineUninstall() {\n        await this.do("display-goodbye", ()=>{\n            console.log(`Goodbye my dear friend ${this.argument.name} \ud83d\udc4b\ud83d\udc4b\ud83d\udc4b`);\n            return Promise.resolve();\n        });\n    }\n}\n'})}),"\n",(0,i.jsx)(n.h3,{id:"type-declarations-1",children:"Type declarations"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:'declare IResult: string;\n\ndeclare IArgument: {\n    name: string;\n    date: string\n} & Resource["IArgument"]\n'})}),"\n",(0,i.jsx)(n.p,{children:"Same as for workflows, this enables type checking and autocompletion."}),"\n",(0,i.jsx)(n.h3,{id:"identity-method",children:"Identity method"}),"\n",(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.code,{children:"identity()"})," method uniquely identifies a resource instance.\nIf two instances share the same identity, they refer to the same real-world object and will share state."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"identity() {\n        return `${this.argument.name}-${this.argument.date}`;\n}\n"})}),"\n",(0,i.jsx)(n.p,{children:"That means that a greeting resource is unique by name and by date."}),"\n",(0,i.jsx)(n.h3,{id:"install-hook",children:"Install hook"}),"\n",(0,i.jsx)(n.p,{children:"Runs once when the resource is first created."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:'async defineInstall() {\n    const greeting = await this.do("greeting", new HelloWorkflow().setArgument({\n        name: this.argument.name\n    }));\n    await this.do("display-greeting", ()=>{\n        console.log(`${greeting}  \ud83d\udc4b\ud83d\udc4b\ud83d\udc4b`);\n        return Promise.resolve();\n    })\n}\n'})}),"\n",(0,i.jsx)(n.h3,{id:"update-hook",children:"Update hook"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"async defineUpdate() {\n        //do nothing\n        console.log(`(I have already seen you.)\ud83d\udc7b`);\n}\n"})}),"\n",(0,i.jsx)(n.p,{children:"Runs every time the resource is reused with the same identity."}),"\n",(0,i.jsx)(n.h3,{id:"uninstall-hook",children:"Uninstall hook"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:'async defineUninstall() {\n        await this.do("display-goodbye", ()=>{\n            console.log(`Goodbye my dear friend ${this.argument.name} \ud83d\udc4b\ud83d\udc4b\ud83d\udc4b`);\n            return Promise.resolve();\n        });\n    }\n'})}),"\n",(0,i.jsx)(n.p,{children:"To trigger it:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"    new GreetingResource().setArgument(...).setCommand('Uninstall');\n"})}),"\n",(0,i.jsx)(n.h3,{id:"go-further--cycle-hook",children:"Go further : cycle hook"}),"\n",(0,i.jsxs)(n.p,{children:["We don't use it in our sample, but resources offer the possibility to launch a cycle command at fixed intervals.\nThis can be useful for recurring tasks like polling, cleanup, or reporting.\nPlease ",(0,i.jsx)(n.a,{href:"/documentation/core-concepts/resource#cycle",children:"see the documentation"})," to learn more."]}),"\n",(0,i.jsx)(n.h2,{id:"orbits",children:"Orbi.ts"}),"\n",(0,i.jsx)(n.p,{children:"In orbi.ts, we do :"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",metastring:'title="src/orbi.ts"',children:'import { Action, ActionRuntime, ActionState } from "@wbce/orbits-core";\nimport { GreetingResource } from "./greetings-resource.ts";\n\nActionRuntime.activeRuntime.waitForBootstrap.then(async ()=>{\n    const greetingOfTheDay = new GreetingResource().setArgument({\n        name: "John Doe",\n        date: String(new Date().toISOString().split("T")[0])\n    })\n    greetingOfTheDay.save();\n    await Action.trackActionAsPromise(greetingOfTheDay, [ActionState.SUCCESS, ActionState.ERROR])\n\n    const greetingOfTheDay2 = new GreetingResource().setArgument({\n        name: "John Doe",\n        date: String(new Date().toISOString().split("T")[0])\n    })\n    greetingOfTheDay2.save();\n    await Action.trackActionAsPromise(greetingOfTheDay2, [ActionState.SUCCESS, ActionState.ERROR])\n})\n'})}),"\n",(0,i.jsx)(n.p,{children:"We launch two times the same Resource.\nThis shows evidence that :"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"during the first run, you will see greeting in console.log"}),"\n",(0,i.jsx)(n.li,{children:'during the second run, you will only see the "I have already seen you" console.log'}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"running-the-sample",children:"Running the sample"}),"\n",(0,i.jsx)(n.h3,{id:"run-the-script",children:"Run the Script"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'export ORBITS_MONGO__URL="your-mongo-cluster"\nnpx tsx src/orbi.ts \n'})}),"\n",(0,i.jsx)(n.p,{children:"Expected Output"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"First run: logs the greeting"}),"\n",(0,i.jsx)(n.li,{children:'Subsequent runs: logs "I have already seen you"'}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"run-the-uninstall-command",children:"Run the uninstall command"}),"\n",(0,i.jsxs)(n.p,{children:["Edit ",(0,i.jsx)(n.code,{children:"orbi.ts"})," :"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",metastring:'title="src/orbi.ts"',children:'ActionRuntime.activeRuntime.waitForBootstrap.then(async ()=>{\n    const greetingOfTheDay = new GreetingResource().setArgument({\n        name: "John Doe",\n        date: String(new Date().toISOString().split("T")[0])\n    }).setCommand("Uninstall")\n    greetingOfTheDay.save();\n)\n'})}),"\n",(0,i.jsx)(n.p,{children:"Then run:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'export ORBITS_MONGO__URL="your-mongo-cluster"\nnpx tsx src/orbi.ts \n'})}),"\n",(0,i.jsx)(n.p,{children:"You should see the goodbye message in the console."}),"\n",(0,i.jsx)(n.h2,{id:"next-steps",children:"Next Steps"}),"\n",(0,i.jsxs)(n.admonition,{title:"What's Next?",type:"tip",children:[(0,i.jsx)(n.p,{children:"Here are three recommended next steps to continue your journey:"}),(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsxs)(n.strong,{children:["\ud83e\udde9 ",(0,i.jsx)(n.a,{href:"/documentation/guides/cross-account-cdk",children:"Cross-account cdk examples"})]})," - Show how to use infrastructure templates in conjonction with orbits"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsxs)(n.strong,{children:["\u2699\ufe0f ",(0,i.jsx)(n.a,{href:"/docs/category/core-concepts",children:"Core-concepts"})]})," - Master the fundamental architecture principles and design patterns that power Orbits"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsxs)(n.strong,{children:["\ud83d\udee4\ufe0f ",(0,i.jsx)(n.a,{href:"/docs/category/guides",children:"Guides"})]})," - Explore hands-on tutorials ranging from beginner-friendly to advanced implementation techniques"]}),"\n"]})]})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},8453:(e,n,t)=>{t.d(n,{R:()=>o,x:()=>l});var s=t(6540);const i={},r=s.createContext(i);function o(e){const n=s.useContext(r);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:o(e.components),s.createElement(r.Provider,{value:n},e.children)}}}]);