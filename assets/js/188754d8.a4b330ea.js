"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[9740],{5930:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>a,contentTitle:()=>c,default:()=>h,frontMatter:()=>o,metadata:()=>s,toc:()=>l});const s=JSON.parse('{"id":"documentation/guides/microservices-orchestration","title":"Microservices Orchestration Example","description":"A practical example to help you orchestrate micro-services using Orbits.","source":"@site/docs/documentation/guides/microservices-orchestration.md","sourceDirName":"documentation/guides","slug":"/documentation/guides/microservices-orchestration","permalink":"/documentation/guides/microservices-orchestration","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":5,"frontMatter":{"sidebar_position":5},"sidebar":"tutorialSidebar","previous":{"title":"An express server over your resources","permalink":"/documentation/guides/express-server"},"next":{"title":"Sponsors","permalink":"/category/sponsors"}}');var i=t(4848),r=t(8453);const o={sidebar_position:5},c="Microservices Orchestration Example",a={},l=[{value:"Scope",id:"scope",level:2},{value:"Installation",id:"installation",level:2},{value:"Clone this repository",id:"clone-this-repository",level:3},{value:"Setup lambdas in aws",id:"setup-lambdas-in-aws",level:3},{value:"Configure environment values",id:"configure-environment-values",level:3},{value:"Project Structure",id:"project-structure",level:2},{value:"The Trading Workflow",id:"the-trading-workflow",level:2},{value:"BuyStockAction",id:"buystockaction",level:2},{value:"Running the sample",id:"running-the-sample",level:2},{value:"Run the Script",id:"run-the-script",level:3},{value:"Next Steps",id:"next-steps",level:2}];function d(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"microservices-orchestration-example",children:"Microservices Orchestration Example"})}),"\n",(0,i.jsx)(n.p,{children:"A practical example to help you orchestrate micro-services using Orbits."}),"\n",(0,i.jsx)(n.h2,{id:"scope",children:"Scope"}),"\n",(0,i.jsxs)(n.p,{children:["In this example, we revisit the classic case of orchestrating a banking transaction. For more context on why and how Orbits can be used to orchestrate microservices, you can check out the ",(0,i.jsx)(n.a,{href:"/blog/workflows-orchestrate-microservices",children:"full blog post"})," on the reason and utility of using orbits to orchestrate microservices."]}),"\n",(0,i.jsxs)(n.p,{children:["This well-known example originates from both ",(0,i.jsx)(n.a,{href:"https://docs.aws.amazon.com/step-functions/latest/dg/sample-lambda-orchestration.html",children:"AWS Step Functions"})," and ",(0,i.jsx)(n.a,{href:"https://temporal.io/blog/temporal-replaces-state-machines-for-distributed-applications",children:"Temporal"}),". Interested readers can refer to these resources to compare the syntax and implementation experience each solution offers."]}),"\n",(0,i.jsx)(n.h2,{id:"installation",children:"Installation"}),"\n",(0,i.jsx)(n.h3,{id:"clone-this-repository",children:"Clone this repository"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Clone ",(0,i.jsx)(n.a,{href:"https://github.com/LaWebcapsule/orbits",children:"this repository"})]}),"\n",(0,i.jsx)(n.li,{children:"Go to this directory :"}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"cd samples/orchestrate-lambda\n"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Install node.js dependencies :\n`npm i``"}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"setup-lambdas-in-aws",children:"Setup lambdas in aws"}),"\n",(0,i.jsx)(n.p,{children:"You'll need to deploy lambdas in aws"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"First of all you'll need an aws account with propers rights."}),"\n",(0,i.jsx)(n.li,{children:"Go to this directory :"}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"cd ./deploy-lambdas\n"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Follow README.md instructions to get API's URL"}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"configure-environment-values",children:"Configure environment values"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Copy the environment template:"}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"cp .base.env .env\n"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Edit .env file with the api url retrieved previously"}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"project-structure",children:"Project Structure"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"\u251c\u2500\u2500 deploy-lambdas/ # Submodule for Lambda deployment\n\u2502   \u251c\u2500\u2500 lambdas/\n\u2502   \u2502   \u251c\u2500\u2500 buy-stock.ts # Buy stock Lambda\n\u2502   \u2502   \u251c\u2500\u2500 check-stock-price.ts # Check stock price Lambda\n\u2502   \u2502   \u251c\u2500\u2500 generate-buy-sell-recommend.ts # Recommendation Lambda\n\u2502   \u2502   \u251c\u2500\u2500 package-lock.json\n\u2502   \u2502   \u251c\u2500\u2500 package.json\n\u2502   \u2502   \u251c\u2500\u2500 sell-stock.ts # Sell stock Lambda\n\u2502   \u2502   \u251c\u2500\u2500 tsconfig.ts\n\u2502   \u2502   \u2514\u2500\u2500 update-one.ts  # not used\n\u2502   \u251c\u2500\u2500 cdk.json\n\u2502   \u251c\u2500\u2500 index.js\n\u2502   \u251c\u2500\u2500 index.ts # lambda CDK stack definition\n\u2502   \u251c\u2500\u2500 package.json\n\u2502   \u251c\u2500\u2500 README.md\n\u2502   \u2514\u2500\u2500 tsconfig.json\n\u251c\u2500\u2500 src/\n\u2502   \u251c\u2500\u2500 orbits/\n\u2502   \u2502   \u251c\u2500\u2500 orbi.ts # Main orchestration script\n\u2502   \u2502   \u251c\u2500\u2500 actions/ \n\u2502   \u2502   \u2502   \u251c\u2500\u2500 buyStock.ts # Buy stock API call action \n\u2502   \u2502   \u2502   \u251c\u2500\u2500 check-stock-price.ts # Check stock price API call action \n\u2502   \u2502   \u2502   \u251c\u2500\u2500 generate-buy-sell-recommendation.ts # Generate a recommendation based on price API call action \n\u2502   \u2502   \u2502   \u2514\u2500\u2500 sellStock.ts # Sell stock API call action \n\u2502   \u2502   \u251c\u2500\u2500 types/\n\u2502   \u2502   \u2502   \u2514\u2500\u2500 stocks.ts # Transaction and Stock type\n\u2502   \u2502   \u2514\u2500\u2500 workflows/\n\u2502   \u2502       \u2514\u2500\u2500 trading.ts # Trading workflow\n\u2502   \u2514\u2500\u2500 const.ts # Utils const\n\u251c\u2500\u2500 .base.env                # Environment template\n\u251c\u2500\u2500 .env                     # Your environment variables (git-ignored)\n\u251c\u2500\u2500 package.json\n\u2514\u2500\u2500 README.md\n"})}),"\n",(0,i.jsx)(n.h2,{id:"the-trading-workflow",children:"The Trading Workflow"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",metastring:'title="src/orbits/workflows/trading.ts"',children:'export class TradingWorkflow extends Workflow{\n\n    declare IResult:StockTransaction\n\n    async define(){\n        const resultCheckStockPrice = await this.do("check-stock-price", new CheckStockPriceAction());\n        const stockPrice = resultCheckStockPrice.stockPrice;\n\n        const resultGenerateBuySellRecommendationAction = await this.do("check-stock-price", new GenerateBuySellRecommendationAction().setArgument(\n            {\n                price:stockPrice.stock_price\n            })); \n\n        const buyOrSellRecommendation = resultGenerateBuySellRecommendationAction.buyOrSellRecommendation\n\n        if (buyOrSellRecommendation === \'sell\') {\n             const resultSellStockData = await this.do("sell-stock", new SellStockeAction().setArgument({\n                price:stockPrice.stock_price\n            }));\n            return resultSellStockData.stockData;\n        } else {\n             const resultBuyStockData = await this.do("buy-stock", new BuyStockAction().setArgument({\n                price:stockPrice.stock_price\n            }));\n            return resultBuyStockData.stockData;\n        }\n\n    };\n}\n'})}),"\n",(0,i.jsxs)(n.p,{children:["This central workflow orchestrates each step by calling autonomous ",(0,i.jsx)(n.strong,{children:"Actions"}),", while maintaining branching logic and intermediate states."]}),"\n",(0,i.jsx)(n.h2,{id:"buystockaction",children:"BuyStockAction"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"export class BuyStockAction extends Action {\n    async main() {\n        const response = await fetch(API_ADDRESS + 'buyStock', {\n            method: 'POST',\n            headers: { 'Content-Type': 'application/json' },\n            body: JSON.stringify({ stock_price: this.argument.price })\n        });\n        this.result.stockData = await response.json();\n        return ActionState.SUCCESS;\n    }\n}\n"})}),"\n",(0,i.jsx)(n.p,{children:"This action:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Takes a typed input (price)"}),"\n",(0,i.jsx)(n.li,{children:"Calls a remote API in an encapsulated manner"}),"\n",(0,i.jsx)(n.li,{children:"Returns a state - ActionState.SUCCESS, ready to be recorded and resumed"}),"\n",(0,i.jsx)(n.li,{children:"Handles errors by default via a state - ActionState.ERROR"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"This structuring makes the action not only easy to test in isolation but also reusable in different workflows, while simplifying its instrumentation for monitoring or debugging."}),"\n",(0,i.jsx)(n.h2,{id:"running-the-sample",children:"Running the sample"}),"\n",(0,i.jsx)(n.h3,{id:"run-the-script",children:"Run the Script"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Load environment variables:\n",(0,i.jsx)(n.code,{children:"bash export $(cat .env | xargs)"})]}),"\n",(0,i.jsxs)(n.li,{children:["Define your mongo_url :\n",(0,i.jsx)(n.code,{children:"bash export ORBITS_DB__MONGO__URL=your-mongo-url"})]}),"\n",(0,i.jsxs)(n.li,{children:["Run your workflow :\n",(0,i.jsx)(n.code,{children:"bash npx tsx src/orbits/orbi.ts"}),"\nThis command will:"]}),"\n",(0,i.jsx)(n.li,{children:"Execute the trading workflow"}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"next-steps",children:"Next Steps"}),"\n",(0,i.jsxs)(n.admonition,{title:"What's Next?",type:"tip",children:[(0,i.jsx)(n.p,{children:"Here are three recommended next steps to continue your journey:"}),(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsxs)(n.strong,{children:["\ud83e\udde9 ",(0,i.jsx)(n.a,{href:"/documentation/guides/cross-account-cdk",children:"Cross-account cdk examples"})]})," - Show how to use infrastructure templates in conjonction with orbits"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsxs)(n.strong,{children:["\u2699\ufe0f ",(0,i.jsx)(n.a,{href:"/docs/category/core-concepts",children:"Core-concepts"})]})," - Master the fundamental architecture principles and design patterns that power Orbits"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsxs)(n.strong,{children:["\ud83d\udee4\ufe0f ",(0,i.jsx)(n.a,{href:"/docs/category/guides",children:"Guides"})]})," - Explore hands-on tutorials ranging from beginner-friendly to advanced implementation techniques"]}),"\n"]})]})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},8453:(e,n,t)=>{t.d(n,{R:()=>o,x:()=>c});var s=t(6540);const i={},r=s.createContext(i);function o(e){const n=s.useContext(r);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:o(e.components),s.createElement(r.Provider,{value:n},e.children)}}}]);