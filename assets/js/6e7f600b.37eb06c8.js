"use strict";(self.webpackChunkorbits_doc=self.webpackChunkorbits_doc||[]).push([[8067],{1027:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>a,contentTitle:()=>l,default:()=>h,frontMatter:()=>r,metadata:()=>i,toc:()=>c});var i=t(1584),s=t(4848),o=t(8453);const r={slug:"ci-cd-in-typescript",title:"Write your CI/CD in TypeScript",authors:["tom"],tags:["orchestration","orbits","cli","aws-cdk","ci/cd"]},l=void 0,a={authorsImageUrls:[void 0]},c=[{value:"Example: handle your CI/CD in Node.js with Orbits",id:"example-handle-your-cicd-in-nodejs-with-orbits",level:2},{value:"Prerequisites",id:"prerequisites",level:3},{value:"Project Setup",id:"project-setup",level:3},{value:"Run the deployment workflow",id:"run-the-deployment-workflow",level:3},{value:"Debugging part of the workflow",id:"debugging-part-of-the-workflow",level:3},{value:"Going further",id:"going-further",level:3}];function d(e){const n={a:"a",code:"code",em:"em",h2:"h2",h3:"h3",hr:"hr",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,o.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.p,{children:"If most CI/CD tools today are robust, the way we define scripts in them comes with a few drawbacks:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"they have strong vendor lock-ins;"}),"\n",(0,s.jsx)(n.li,{children:"they are difficult to test and debug locally;"}),"\n",(0,s.jsx)(n.li,{children:"they all use a different syntax in YAML, which is difficult to extend and compose.\nFor all these reasons, when the person who wrote them is not around, it\u2019s not uncommon that teams don\u2019t know what scripts do. They rarely evolve and their maintenance is hard."}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"Using code and native Node.js modules to write CI/CD could solve all these problems and comes with a lot of benefits:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"it\u2019s possible to debug locally. To avoid regressions, it's even possible to test the CI/CD with a normal testing framework;"}),"\n",(0,s.jsx)(n.li,{children:"it offers better reusability across projects and greater composability;"}),"\n",(0,s.jsx)(n.li,{children:"it uses code instead of configuration, making it easy to catch errors, manage retries, loops, and conditional logic;"}),"\n",(0,s.jsx)(n.li,{children:"it integrates seamlessly with the rich Node.js ecosystem."}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"ci-cd",src:t(1441).A+"",width:"1534",height:"644"})}),"\n",(0,s.jsx)(n.h2,{id:"example-handle-your-cicd-in-nodejs-with-orbits",children:"Example: handle your CI/CD in Node.js with Orbits"}),"\n",(0,s.jsxs)(n.p,{children:["This blog post will follow the ",(0,s.jsx)(n.a,{href:"https://github.com/LaWebcapsule/orbits/tree/main/samples/simple-deployment-pipeline",children:"simple deployment pipeline sample"})," available on the github repository of orbits."]}),"\n",(0,s.jsx)(n.p,{children:"This sample deploys an AWS Lambda that will respond to a GET request with this architecture:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502   cloudfront   \u2502\u25c4\u2500\u2500\u25ba\u2502   api gateway  \u2502\u25c4\u2500\u2500\u25ba\u2502   lambda       \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n"})}),"\n",(0,s.jsx)(n.p,{children:"Our complete workflow is:"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:"Format, lint and test our Lambda code"}),"\n",(0,s.jsx)(n.li,{children:"Deploy it to AWS using CDK and the orbits CDK helper"}),"\n",(0,s.jsx)(n.li,{children:"Clear the CloudFront cache"}),"\n",(0,s.jsx)(n.li,{children:"Check the deployed endpoint"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,s.jsx)(n.p,{children:"You'll need:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Access to one AWS account"}),"\n",(0,s.jsx)(n.li,{children:"Node.js and npm installed"}),"\n",(0,s.jsx)(n.li,{children:"MongoDB instance for orbits state management"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"project-setup",children:"Project Setup"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"# Clone the repository\ngit clone https://github.com/LaWebcapsule/orbits.git\ncd samples/simple-deployment-pipeline\n\n# Install dependencies\nnpm install\n\n# Configure environment\nexport AWS_REGION=you-aws-region\nexport AWS_ACCOUNT=you-aws-account\n\n# Install the CLI either globally or in your project\n## globally\nnpm i @orbi-ts/cli -g\n\n## in your project\nnpm i @orbi-ts/cli\n\n# define your mongo_url\n## default is mongodb://localhost:27017/orbits\nexport ORBITS_DB__MONGO__URL=your-mongo-url\n"})}),"\n",(0,s.jsx)(n.h3,{id:"run-the-deployment-workflow",children:"Run the deployment workflow"}),"\n",(0,s.jsxs)(n.p,{children:["From peeking at ",(0,s.jsx)(n.code,{children:"orbi.ts"})," we see that ",(0,s.jsx)(n.code,{children:"DeployHelloWorkflow"})," takes two arguments:"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"region"}),": the AWS region"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"account"}),": the AWS account"]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"So running it is as easy as typing this command:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"orbits-cli actions run -f src/orbits/orbi.ts --local-worker \\\n  DeployHelloWorkflow \\\n  region=$AWS_REGION \\\n  account=$AWS_ACCOUNT\n"})}),"\n",(0,s.jsx)(n.p,{children:"Here is a video of the deployment:"}),"\n",(0,s.jsx)("video",{controls:!0,width:"100%",children:(0,s.jsx)("source",{src:"https://orbits-assets.s3.eu-west-3.amazonaws.com/public/videos/cli-run.mp4"})}),"\n",(0,s.jsx)("br",{}),"\n",(0,s.jsx)("br",{}),"\n",(0,s.jsxs)(n.p,{children:["We can get the result of the deploy action using the get method (provided its ID is ",(0,s.jsx)(n.code,{children:"689de1b3fcb667fee45a4bfe"}),"):"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:'\u279c orbits-cli actions get 689de1b3fcb667fee45a4bfe\nID                       \u2506 ACTION REF     \u2506 STATE   \u2506 RESULT                                                                                                                                                             \u2506 LAST ACTIVITY \u2506 NEXT ACTIVITY \u2506 PARENT > REF\n\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\u2508\n689de1b3fcb667fee45a4bfe \u2506 LambdaResource \u2506 SUCCESS \u2506 {"CfId":"E28NIDFX6OEEC6","HelloAPIEndpointA3FBFD89":"https://fueo1zarcg.execute-api.eu-west-3.amazonaws.com/prod/","CfDomainName":"d16q083cvq1ymk.cloudfront.net"} \u2506 \u2014             \u2506 in 7min 45s   \u2506 689de1b1fcb667fee45a4bc1 > deploy\n'})}),"\n",(0,s.jsx)(n.p,{children:"With its ID, you can get the graphical view of an Action / Workflow at any moment:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"orbits-cli actions watch <ACTION_ID>\n"})}),"\n",(0,s.jsx)(n.p,{children:"With this in mind, you have a complete history of your deployment and can see precisely where it failed."}),"\n",(0,s.jsx)(n.h3,{id:"debugging-part-of-the-workflow",children:"Debugging part of the workflow"}),"\n",(0,s.jsx)(n.p,{children:"In this section, we\u2019ll introduce a failure in the Code Quality workflow and see how it shows up during execution."}),"\n",(0,s.jsx)(n.p,{children:"First, here\u2019s how our deployment workflow is defined:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",metastring:'title="src/orbits/orbi.ts"',children:"import { Workflow } from '@orbi-ts/core';\nimport { CodeQualityWorkflow } from './code-quality';\nimport { InvalidateCacheAction } from './invalidate-cache';\nimport { LambdaResource } from './lambda-resource';\nimport { VerifyLambdaDeploymentAction } from './verify';\n\nexport class DeployHelloWorkflow extends Workflow {\n    declare IArgument: Workflow['IArgument'] & {\n        region: string;\n        account: string;\n    };\n\n    async define() {\n        await this.do('quality', new CodeQualityWorkflow());\n        const result = await this.do(\n            'deploy',\n            new LambdaResource({\n                region: this.argument.region,\n                account: this.argument.account,\n            })\n        );\n\n        await this.do(\n            'invalidate cache',\n            new InvalidateCacheAction().setArgument({\n                distributionId: result.CfId,\n                env: { region: this.argument.region },\n            })\n        );\n\n        await this.do(\n            'verify',\n            new VerifyLambdaDeploymentAction().setArgument({\n                endpoint: `https://${result.CfDomainName}`,\n            })\n        );\n    }\n}\n"})}),"\n",(0,s.jsx)(n.p,{children:"Because we know the name of an action and its arguments, running it directly is very simple."}),"\n",(0,s.jsxs)(n.p,{children:["Let\u2019s try running the ",(0,s.jsx)(n.em,{children:"Code Quality"})," workflow. Since the ",(0,s.jsx)(n.code,{children:"DeployHelloWorkflow"})," action doesn\u2019t require arguments, we can run:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"orbits-cli actions run CodeQualityWorkflow -f src/orbits/orbi.ts --local-worker\n"})}),"\n",(0,s.jsx)(n.p,{children:"We get the following graphical view of the workflow \u2014 everything is green, no errors!"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"run results",src:t(9611).A+"",width:"3420",height:"2138"})}),"\n",(0,s.jsx)(n.p,{children:"Now let\u2019s make the handler fail the tests. We\u2019ll modify the code as follows:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",metastring:'title="src/handler/hello.ts"',children:"type HelloEvent = {\n    queryStringParameters: {\n        first_name?: string;\n        last_name?: string;\n    };\n};\n\nexport const handler = async (\n    event: HelloEvent\n): Promise<{\n    statusCode: number;\n    body: string;\n}> => {\n    // const firstName = event.queryStringParameters.first_name;\n    const firstName = 'Alice';\n    const lastName = event.queryStringParameters.last_name;\n    const now = new Date();\n    return {\n        statusCode: 200,\n        body:\n            `Hello ${[firstName, lastName].filter(Boolean).join(' ') || 'Guest'}, ` +\n            `time is ${now.getUTCHours()}:${now.getUTCMinutes()}:${now.getUTCSeconds()} (UTC)`,\n    };\n};\n"})}),"\n",(0,s.jsxs)(n.p,{children:["When we re-run without exiting the process, the workflow fails and moves into the ",(0,s.jsx)(n.code,{children:"ERROR"})," state. We can inspect the error in the logs, or view the result in the dedicated panel:"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"run fail",src:t(4706).A+"",width:"3420",height:"2138"})}),"\n",(0,s.jsx)(n.p,{children:"Let\u2019s fix the test by restoring the original line:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:"const firstName = event.queryStringParameters.first_name;\n// const firstName = 'Alice'; <-- remove this line\n"})}),"\n",(0,s.jsx)(n.p,{children:"Now, in another terminal, we can replay the test action by its ID:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"orbits-cli actions replay $ACTION_ID\n"})}),"\n",(0,s.jsx)(n.p,{children:"Or replay the entire workflow starting from the test step:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"orbits-cli actions replay $WORKFLOW_ID -p test\n"})}),"\n",(0,s.jsx)(n.p,{children:"This time everything passes again \u2014 back to green \u2705."}),"\n",(0,s.jsx)(n.p,{children:"See it in action:"}),"\n",(0,s.jsx)("video",{controls:!0,width:"100%",children:(0,s.jsx)("source",{src:"https://orbits-assets.s3.eu-west-3.amazonaws.com/public/videos/cli-replay.mp4"})}),"\n",(0,s.jsx)("br",{}),"\n",(0,s.jsx)("br",{}),"\n",(0,s.jsx)(n.h3,{id:"going-further",children:"Going further"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"You can now write and integrate CI/CD workflows directly into your own project."}),"\n",(0,s.jsxs)(n.li,{children:["More than just workflows, orbits is especially useful when you want to share workflows across projects and tenants. Read our ",(0,s.jsx)(n.a,{href:"/blog/orchestration-typescript",children:"blog series about orchestration"}),"."]}),"\n",(0,s.jsxs)(n.li,{children:["As the project grows, we plan to add more helper functions to quickly build your CI/CD. Stay up to date by following the ",(0,s.jsx)(n.a,{href:"https://github.com/LaWebcapsule/orbits",children:"github repository"}),"."]}),"\n"]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsxs)(n.em,{children:["Wanna try it yourself? The complete example code and setup instructions are available in the ",(0,s.jsx)(n.a,{href:"https://github.com/LaWebcapsule/orbits/tree/main/samples/simple-deployment-pipeline",children:"github repository"}),". Give it a spin!"]})})]})}function h(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}},1441:(e,n,t)=>{t.d(n,{A:()=>i});const i=t.p+"assets/images/singe-ci-cd-a48abc34e4df28cef342f6e8657142e5.png"},1584:e=>{e.exports=JSON.parse('{"permalink":"/blog/ci-cd-in-typescript","editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/blog/2025-08-27-ci-cd-in-typescript.md","source":"@site/blog/2025-08-27-ci-cd-in-typescript.md","title":"Write your CI/CD in TypeScript","description":"If most CI/CD tools today are robust, the way we define scripts in them comes with a few drawbacks:","date":"2025-08-27T00:00:00.000Z","tags":[{"inline":true,"label":"orchestration","permalink":"/blog/tags/orchestration"},{"inline":false,"label":"OrbiTS","permalink":"/blog/tags/orbits","description":"Posts related to OrbiTS"},{"inline":false,"label":"CLI","permalink":"/blog/tags/cli","description":"Posts related to OrbiTS CLI"},{"inline":false,"label":"AWS CDK","permalink":"/blog/tags/aws-cdk","description":"Posts related to the AWS CDK"},{"inline":true,"label":"ci/cd","permalink":"/blog/tags/ci-cd"}],"readingTime":5.01,"hasTruncateMarker":true,"authors":[{"name":"Tom Marcuzzi","title":"Head of engineering @ Webcapsule","url":"https://linkedin.com/in/tom-marcuzzi","page":{"permalink":"/blog/authors/tom"},"socials":{"linkedin":"https://www.linkedin.com/in/tommarcuzzi/","github":"https://github.com/tommarcuzzi"},"imageURL":"/img/authors/tom.png","key":"tom"}],"frontMatter":{"slug":"ci-cd-in-typescript","title":"Write your CI/CD in TypeScript","authors":["tom"],"tags":["orchestration","orbits","cli","aws-cdk","ci/cd"]},"unlisted":false,"prevItem":{"title":"Orchestrating a stack of services across multiple environments","permalink":"/blog/orchestrate-stack"},"nextItem":{"title":"A deployment workflow with TypeScript","permalink":"/blog/orchestration-typescript"}}')},4706:(e,n,t)=>{t.d(n,{A:()=>i});const i=t.p+"assets/images/test-run-fail-0bd41d893b42f0b91fa56483ab7fd64a.png"},8453:(e,n,t)=>{t.d(n,{R:()=>r,x:()=>l});var i=t(6540);const s={},o=i.createContext(s);function r(e){const n=i.useContext(o);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:r(e.components),i.createElement(o.Provider,{value:n},e.children)}},9611:(e,n,t)=>{t.d(n,{A:()=>i});const i=t.p+"assets/images/test-run-c013a12b769ee2ecc80f4359a5ae9cbb.png"}}]);